Extract:   0%|          | 0/40455 [00:00<?, ?it/s]Extract:   0%|          | 0/40455 [00:02<?, ?it/s]
Traceback (most recent call last):
  File "/usr/lib/python3.8/runpy.py", line 194, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/lib/python3.8/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/home2/jmsk62/project/mechanistic_intrep/mechanistic/extract/activation_extractor.py", line 263, in <module>
    main()
  File "/home2/jmsk62/project/mechanistic_intrep/mechanistic/extract/activation_extractor.py", line 258, in main
    Extractor(cfg).run_extract(images_dir, captions_csv, out_root)
  File "/home2/jmsk62/project/mechanistic_intrep/mechanistic/extract/activation_extractor.py", line 159, in run_extract
    self.process_row(r, images_dir, acts_dir, metrics_rows)
  File "/home2/jmsk62/project/mechanistic_intrep/mechanistic/extract/activation_extractor.py", line 107, in process_row
    _ = self.clip_encode_image(pil)
  File "/home2/jmsk62/project/mechanistic_intrep/mech_intrep/env/lib/python3.8/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
  File "/home2/jmsk62/project/mechanistic_intrep/mechanistic/extract/activation_extractor.py", line 93, in clip_encode_image
    _ = self.clip.vision_model(**{"pixel_values": enc["pixel_values"]})
  File "/home2/jmsk62/project/mechanistic_intrep/mech_intrep/env/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home2/jmsk62/project/mechanistic_intrep/mech_intrep/env/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home2/jmsk62/project/mechanistic_intrep/mech_intrep/env/lib/python3.8/site-packages/transformers/models/clip/modeling_clip.py", line 1097, in forward
    encoder_outputs = self.encoder(
  File "/home2/jmsk62/project/mechanistic_intrep/mech_intrep/env/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home2/jmsk62/project/mechanistic_intrep/mech_intrep/env/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home2/jmsk62/project/mechanistic_intrep/mech_intrep/env/lib/python3.8/site-packages/transformers/models/clip/modeling_clip.py", line 877, in forward
    layer_outputs = encoder_layer(
  File "/home2/jmsk62/project/mechanistic_intrep/mech_intrep/env/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home2/jmsk62/project/mechanistic_intrep/mech_intrep/env/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1616, in _call_impl
    hook_result = hook(self, args, result)
  File "/home2/jmsk62/project/mechanistic_intrep/mechanistic/extract/activation_extractor.py", line 56, in fn
    self.hooks.setdefault(name, []).append(out.detach().to("cpu"))
AttributeError: 'tuple' object has no attribute 'detach'
srun: error: gpu3: task 0: Exited with exit code 1
