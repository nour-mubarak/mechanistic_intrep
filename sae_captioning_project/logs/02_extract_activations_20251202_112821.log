2025-12-02 11:28:26,407 - INFO - Loading model: google/gemma-3-4b-it
Fetching 2 files:   0%|          | 0/2 [00:00<?, ?it/s]Fetching 2 files:  50%|█████     | 1/2 [00:00<00:00,  3.73it/s]Fetching 2 files: 100%|██████████| 2/2 [00:00<00:00,  7.46it/s]
Using a slow image processor as `use_fast` is unset and a slow processor was saved with this model. `use_fast=True` will be the default behavior in v4.52, even if the model was saved with a slow processor. This will result in minor differences in outputs. You'll still be able to use a slow processor with `use_fast=False`.
`torch_dtype` is deprecated! Use `dtype` instead!
Fetching 2 files:   0%|          | 0/2 [00:00<?, ?it/s]Fetching 2 files:  50%|█████     | 1/2 [01:07<01:07, 67.47s/it]Fetching 2 files: 100%|██████████| 2/2 [01:07<00:00, 33.73s/it]
2025-12-02 11:29:41,965 - INFO - We will use 90% of the memory on device 0 for storing the model, and 10% for the buffer to avoid OOM. You can set `max_memory` in to a higher value to use more memory (at your own risk).
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:01<00:01,  1.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:02<00:00,  1.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:02<00:00,  1.31s/it]
2025-12-02 11:29:45,052 - INFO - Model loaded with dtype torch.float16
Traceback (most recent call last):
  File "/home/nour/mchanistic project/mechanistic_intrep/sae_captioning_project/scripts/02_extract_activations.py", line 83, in get_model_hidden_size
    return model.model.layers[0].mlp.gate_proj.in_features
  File "/home/nour/mchanistic project/mechanistic_intrep/env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1962, in __getattr__
    raise AttributeError(
AttributeError: 'Gemma3Model' object has no attribute 'layers'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/nour/mchanistic project/mechanistic_intrep/sae_captioning_project/scripts/02_extract_activations.py", line 271, in <module>
    sys.exit(main())
  File "/home/nour/mchanistic project/mechanistic_intrep/sae_captioning_project/scripts/02_extract_activations.py", line 180, in main
    hidden_size = get_model_hidden_size(model)
  File "/home/nour/mchanistic project/mechanistic_intrep/sae_captioning_project/scripts/02_extract_activations.py", line 85, in get_model_hidden_size
    raise ValueError("Could not determine model hidden size")
ValueError: Could not determine model hidden size
